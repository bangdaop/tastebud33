<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Taste Buds Choices</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0; font-family:"Poppins",sans-serif;
      background:linear-gradient(135deg,#ffecd2,#fcb69f);
      display:flex; justify-content:center; padding:40px;
    }
    .container {
      max-width:800px; width:100%;
      background:#fff; border-radius:20px;
      box-shadow:0 12px 40px rgba(0,0,0,0.15);
      padding:32px; animation:fadeIn 1s ease;
    }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }
    h2 {
      margin:0; font-size:28px; font-weight:700;
      color:#0d3b66; text-align:center;
      text-shadow:2px 2px 4px rgba(0,0,0,0.2);
    }
    .tagline {
      text-align:center; color:#444; margin:10px 0 20px; font-size:16px;
      text-shadow:1px 1px 3px rgba(0,0,0,0.15);
    }
    .field-row { margin:20px 0; display:flex; flex-direction:column; }
    .field-row label { font-weight:600; margin-bottom:6px; color:#444; }
    select,input,textarea {
      padding:12px; border-radius:10px; border:1px solid #ccc; font-size:15px;
      transition:all .2s ease;
    }
    select:focus,input:focus,textarea:focus { border-color:#f77f00; box-shadow:0 0 8px rgba(247,127,0,0.3); }
    button {
      background:#f77f00; color:#fff; border:none; padding:12px 20px;
      border-radius:12px; font-weight:600; cursor:pointer; transition:.2s;
    }
    button:hover { background:#d96c00; }
    #submitMsg { margin-top:20px; text-align:center; font-size:16px; font-weight:600; color:#333; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Taste Buds Choices</h2>
    <div class="tagline">Pick your combo ‚Äì we‚Äôre dropping it near you.<br>Lock your picks and we will deliver vibes üòç</div>
    <div id="formContainer"></div>
    <button id="submitBtn">Finish</button>
    <div id="submitMsg"></div>
  </div>

<script>
const WEBAPP_URL = "YOUR_WEBAPP_URL_HERE"; // replace with your deployed Apps Script URL

// Generate persistent sessionId
let sessionId = localStorage.getItem("tb_session_id");
if (!sessionId) {
  sessionId = Math.random().toString(36).slice(2,10);
  localStorage.setItem("tb_session_id", sessionId);
}

// Store answers
const answers = {};

function buildForm(config){
  const container=document.getElementById("formContainer");
  container.innerHTML="";

  config.forEach(field=>{
    const wrapper=document.createElement("div"); wrapper.className="field-row";
    const label=document.createElement("label"); label.textContent=field.label; wrapper.appendChild(label);

    if(field.type==="select"){
      const sel=document.createElement("select");
      const placeholder=document.createElement("option"); placeholder.value=""; placeholder.textContent="Select"; placeholder.selected=true;
      sel.appendChild(placeholder);
      if(field.options){
        field.options.split(/;|,/).forEach(o=>{
          const opt=document.createElement("option"); opt.value=o.trim(); opt.textContent=o.trim(); sel.appendChild(opt);
        });
      }
      sel.onchange=()=>{ if(sel.querySelector('option[value=""]')) sel.removeChild(sel.querySelector('option[value=""]')); answers[field.key]=sel.value; postAutosave(field.key,sel.value); };
      wrapper.appendChild(sel);
    }
    else if(field.type==="radio"){
      if(field.options){
        field.options.split(/;|,/).forEach(o=>{
          const row=document.createElement("label");
          const r=document.createElement("input"); r.type="radio"; r.name=field.key; r.value=o.trim();
          r.onchange=()=>{answers[field.key]=o.trim(); postAutosave(field.key,o.trim());};
          row.appendChild(r); row.appendChild(document.createTextNode(" "+o.trim()));
          wrapper.appendChild(row);
        });
      }
    }
    else if(field.type==="text"){
      const inp=document.createElement("input"); inp.type="text";
      inp.onblur=()=>{answers[field.key]=inp.value; postAutosave(field.key,inp.value);};
      wrapper.appendChild(inp);
    }
    else if(field.type==="textarea"){
      const ta=document.createElement("textarea");
      ta.onblur=()=>{answers[field.key]=ta.value; postAutosave(field.key,ta.value);};
      wrapper.appendChild(ta);
    }

    container.appendChild(wrapper);
  });
}

function postAutosave(fieldName,fieldValue){
  fetch(WEBAPP_URL,{
    method:"POST",
    body:JSON.stringify({sessionId,fieldName,fieldValue})
  });
}

// Load config dynamically
function loadConfig(){
  fetch(WEBAPP_URL)
    .then(r=>r.json())
    .then(data=>{
      if(data.status==="ok"){
        buildForm(data.config);
      } else {
        document.getElementById("formContainer").textContent="Error loading form config.";
      }
    });
}

// Handle final submit
document.getElementById("submitBtn").onclick = () => {
  fetch(WEBAPP_URL, {
    method: "POST",
    body: JSON.stringify({
      sessionId,
      submitted: true,
      answers
    })
  }).then(() => {
    document.getElementById("submitMsg").textContent =
      "Thanks for completing Taste Buds Choices! üéâ";
  });
};

// Build form on load
window.onload = loadConfig;
</script>
</body>
</html>
