<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>üî• Taste Buds Choices üçüü•üü•§</title>
    <div class="heroTitle">üî• Taste Buds Choices üçüü•üü•§</div>
    <div class="heroSub">Pick your combo ‚Äî we‚Äôll deliver the vibe ‚ú®</div>


    <style>
        body {
            margin: 0;
            font-family: system-ui;
            background: #f5f7fa;
        }

        .app {
            max-width: 700px;
            margin: auto;
            padding: 12px;
        }

        .header {
            position: relative;
            border-radius: 16px;
            overflow: hidden;
            margin-bottom: 16px;
        }

        .header img {
            width: 100%;
            display: block;
        }

        .heroTitle {
            position: absolute;
            bottom: 12px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 26px;
            font-weight: 900;
            color: #fff;
            text-shadow:
                0 0 10px #ff4d4d,
                0 0 25px #ff4d4d,
                0 0 40px #ff4d4d;
        }

        .heroSub {
            position: absolute;
            bottom: 40px;
            left: 0;
            right: 0;
            text-align: center;
            color: #ffe;
            font-size: 14px;
            font-weight: 600;
            text-shadow: 0 0 8px #ff4d4d;
        }


        #loadWrap {
            margin: 12px 0;
        }

        #loadTrack {
            height: 6px;
            background: #ddd;
            border-radius: 6px;
            overflow: hidden;
        }

        #loadBar {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #ff7a00, #ffb347);
            transition: .3s;
        }

        #loadText {
            text-align: center;
            font-size: 12px;
            margin-top: 6px;
        }

        #surveyWrap {
            margin: 12px 0;
        }

        #surveyBar {
            height: 6px;
            background: #ddd;
            border-radius: 6px;
            overflow: hidden;
        }

        #surveyBarInner {
            height: 100%;
            width: 0%;
            background: linear-gradient(90deg, #0d3b66, #3fa9f5);
            transition: .3s;
        }

        .field {
            background: white;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 12px;
            box-shadow: 0 2px 6px rgba(0, 0, 0, .05);
            animation: fadeUp .3s ease;
        }

        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(10px)
            }

            to {
                opacity: 1;
                transform: none
            }
        }

        label {
            font-weight: 700;
            display: block;
            margin-bottom: 6px;
        }

        select,
        input {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 15px;
        }

        .stateBox,
        .ageTag {
            margin-top: 6px;
            font-weight: 600;
            color: #0d3b66;
            display: none;
        }

        #submitBtn {
            width: 100%;
            padding: 12px;
            border: none;
            border-radius: 10px;
            background: #0d3b66;
            color: white;
            font-weight: 800;
            margin-top: 12px;
            opacity: .4;
        }

        #summaryList {
            margin-top: 20px;
        }

        .summary-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            padding: 6px 0;
        }

        #thanks {
            display: none;
            text-align: center;
            padding: 40px 20px;
            font-size: 18px;
            font-weight: 700;
        }
    </style>
</head>

<body>

    <div class="app">

        <div class="header">
            <img src="https://raw.githubusercontent.com/bangdaop/33cimg/main/photo_6062312442882100596_y.jpg">
            <div class="heroTitle">üî• Taste Buds Choices üçüü•üü•§</div>
        </div>

        <div id="loadWrap">
            <div id="loadTrack">
                <div id="loadBar"></div>
            </div>
            <div id="loadText">Loading‚Ä¶</div>
        </div>

        <div id="surveyWrap">
            <div id="surveyBar">
                <div id="surveyBarInner"></div>
            </div>
        </div>

        <div id="formWrapper"></div>

        <button id="submitBtn" disabled>Finish</button>

        <div id="thanks"></div>

    </div>

    <script>

        const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbwXlYjodsqdwXD1lpUObHRUxO-4g99cRvMU77rJ3YMi7ySHMHmiLM-hNceq5RvbCTUw/exec";

        const answers = {}
        let configFields = []
        let cityMap = {}
        let ageTags = {}

        function qs(x) { return document.querySelector(x) }
        function el(t, a = {}, ...c) { const n = document.createElement(t); for (const k in a) n.setAttribute(k, a[k]); c.forEach(x => n.append(x)); return n }

        function setLoad(p) {
            qs('#loadBar').style.width = p + '%'
            qs('#loadText').innerText = 'Loading‚Ä¶ ' + p + '%'
        }

        function updateProgress() {
            let done = 0
            configFields.forEach(f => {
                const v = answers[f.key]
                if (v !== undefined && v !== '') done++
            })
            const pct = Math.round(done / configFields.length * 100)
            qs('#surveyBarInner').style.width = pct + '%'
            qs('#submitBtn').disabled = done !== configFields.length
            qs('#submitBtn').style.opacity = done === configFields.length ? '1' : '0.4'
        }

        async function loadConfig() {
            try {
                setLoad(20)
                const r = await fetch(WEBAPP_URL)
                setLoad(60)
                const j = await r.json()

                configFields = j.config || []
                cityMap = j.cityMappings?.cityToState || {}
                j.ageTags?.forEach(a => ageTags[a.key] = a.displayLabel)

                setLoad(85)
                buildForm()
                setTimeout(() => qs('#loadWrap').style.display = 'none', 300)
            } catch (e) {
                qs('#loadText').innerText = 'Failed loading form'
            }
        }

        function buildForm() {
            const w = qs('#formWrapper')
            w.innerHTML = ''

            configFields.forEach(f => {
                const box = el('div', { class: 'field' })
                box.append(el('label', {}, f.label))

                if (f.type === 'select') {
                    const s = el('select')
                    s.append(el('option', { value: '', disabled: true, selected: true }, 'Select‚Ä¶'))

                    f.options.split(/;|,/).forEach(o => {
                        const v = o.trim()
                        if (v) s.append(el('option', { value: v }, v))
                    })

                    const state = el('div', { class: 'stateBox' })
                    const ageTag = el('div', { class: 'ageTag' })

                    s.onchange = () => {
                        answers[f.key] = s.value

                        if (f.key === 'City') {
                            state.innerText = 'üìç ' + (cityMap[s.value] || '')
                            state.style.display = 'block'
                        }

                        if (f.key === 'Age') {
                            ageTag.innerText = '‚ú® ' + (ageTags[s.value] || '')
                            ageTag.style.display = 'block'
                        }

                        updateProgress()
                    }

                    box.append(s)
                    if (f.key === 'City') box.append(state)
                    if (f.key === 'Age') { box.prepend(ageTag) }

                }

                else if (f.type === 'number' || f.type === 'text') {
                    const i = el('input', { type: f.type })
                    i.oninput = () => { answers[f.key] = i.value; updateProgress() }
                    box.append(i)
                }

                else if (f.type === 'radio') {
                    f.options.split(/;|,/).forEach(o => {
                        const v = o.trim()
                        if (!v) return
                        const r = el('input', { type: 'radio', name: f.key })
                        r.onchange = () => { answers[f.key] = v; updateProgress() }
                        box.append(el('label', {}, r, ' ' + v))
                    })
                }

                w.append(box)
            })

        }

        qs('#submitBtn').onclick = async () => {
            await fetch(WEBAPP_URL, { method: 'POST', body: JSON.stringify({ submitted: true, answers }) })

            let out = 'Thank you guys!! See ya soon with Smoky Flavours üéâ‚ù§Ô∏è‚Äçüî•<br><br>'
            Object.keys(answers).forEach(k => {
                out += `<div>${k} : ${answers[k]}</div>`
            })

            qs('#formWrapper').innerHTML = ''
            qs('#submitBtn').style.display = 'none'
            qs('#thanks').innerHTML = out
            qs('#thanks').style.display = 'block'
        }

        loadConfig()

    </script>

</body>

</html>
