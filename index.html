<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>Taste Buds Choices</title>
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <style>
    body {
      margin:0; font-family:"Poppins",sans-serif;
      background:linear-gradient(135deg,#ffecd2,#fcb69f);
      display:flex; justify-content:center; padding:40px;
    }
    .container {
      max-width:800px; width:100%;
      background:#fff; border-radius:20px;
      box-shadow:0 12px 40px rgba(0,0,0,0.15);
      padding:32px; animation:fadeIn 1s ease;
    }
    @keyframes fadeIn { from{opacity:0;transform:translateY(20px);} to{opacity:1;transform:translateY(0);} }
    h2 {
      margin:0; font-size:28px; font-weight:700;
      color:#0d3b66; text-align:center;
      text-shadow:2px 2px 4px rgba(0,0,0,0.2);
    }
    .tagline {
      text-align:center; color:#444; margin:10px 0 20px; font-size:16px;
      text-shadow:1px 1px 3px rgba(0,0,0,0.15);
    }
    .field-row { margin:20px 0; display:flex; flex-direction:column; }
    .field-row label { font-weight:600; margin-bottom:6px; color:#444; }
    select,input,textarea {
      padding:12px; border-radius:10px; border:1px solid #ccc; font-size:15px;
      transition:all .2s ease;
    }
    select:focus,input:focus,textarea:focus { border-color:#f77f00; box-shadow:0 0 8px rgba(247,127,0,0.3); }
    .state-display { margin-top:6px; font-weight:600; color:#555; }
    button {
      background:#f77f00; color:#fff; border:none; padding:12px 20px;
      border-radius:12px; font-weight:600; cursor:pointer; transition:.2s;
    }
    button:hover { background:#d96c00; }
    #submitMsg { margin-top:20px; text-align:center; font-size:16px; font-weight:600; color:#333; }
  </style>
</head>
<body>
  <div class="container">
    <h2>Taste Buds Choices</h2>
    <div class="tagline">Pick your combo ‚Äì we‚Äôre dropping it near you.<br>Lock your picks and we will deliver vibes üòç</div>
    <div id="formContainer"></div>
    <button id="submitBtn">Finish</button>
    <div id="submitMsg"></div>
  </div>

<script>
const WEBAPP_URL = "https://script.google.com/macros/s/AKfycbywZvzhUFXH0EqljIfI-AlwmKwcxeGPzMYUH4eHLSQ1-iFYUV93CPkTFvqwaANl3EoD/exec";

// Generate persistent sessionId
let sessionId = localStorage.getItem("tb_session_id");
if (!sessionId) {
  sessionId = Math.random().toString(36).slice(2,10);
  localStorage.setItem("tb_session_id", sessionId);
}

// City mapping
const cityToState = {"Delhi":"Delhi","Mumbai":"Maharashtra","Bengaluru":"Karnataka","Mangaluru":"Karnataka","Chennai":"Tamil Nadu","Hyderabad":"Telangana","Kolkata":"West Bengal","Ahmedabad":"Gujarat","Jaipur":"Rajasthan","Lucknow":"Uttar Pradesh","Pune":"Maharashtra","Surat":"Gujarat","Patna":"Bihar","Indore":"Madhya Pradesh","Guwahati":"Assam"};
const cityToRegion = {"Delhi":"North","Mumbai":"West","Bengaluru":"South","Mangaluru":"South","Chennai":"South","Hyderabad":"South","Kolkata":"East","Ahmedabad":"West","Jaipur":"North","Lucknow":"North","Pune":"West","Surat":"West","Patna":"East","Indore":"Central","Guwahati":"Northeast"};
const cities = Object.keys(cityToState).sort();

// Store answers
const answers = {};

function buildForm(){
  const container=document.getElementById("formContainer");

  // Age group
  addSelect(container,"ageGroup","Select your age group",["Below 18","18‚Äì23","24‚Äì28","29‚Äì35","35‚Äì45","46+"]);

  // Gender
  addRadio(container,"gender","Select your gender",["Male","Female","Other","Prefer not to say"]);

  // City
  const wrapper=document.createElement("div"); wrapper.className="field-row";
  const label=document.createElement("label"); label.textContent="Select your city"; wrapper.appendChild(label);
  const sel=document.createElement("select");
  const placeholder=document.createElement("option"); placeholder.value=""; placeholder.textContent="Select your city"; placeholder.selected=true;
  sel.appendChild(placeholder);
  cities.forEach(c=>{const opt=document.createElement("option"); opt.value=c; opt.textContent=c; sel.appendChild(opt);});
  const stateDisplay=document.createElement("div"); stateDisplay.className="state-display";
  sel.onchange=()=>{
    const chosenCity=sel.value;
    const state=cityToState[chosenCity]||""; const region=cityToRegion[chosenCity]||"";
    stateDisplay.textContent= state ? "State: "+state+" | Region: "+region : "";
    if(sel.querySelector('option[value=""]')) sel.removeChild(sel.querySelector('option[value=""]'));
    answers.city=chosenCity; answers.state=state; answers.region=region;
    postAutosave("city",chosenCity,{state,region});
  };
  wrapper.appendChild(sel); wrapper.appendChild(stateDisplay); container.appendChild(wrapper);

  // Occupation
  addText(container,"occupation","Your occupation");
}

function addSelect(container,key,labelText,options){
  const wrapper=document.createElement("div"); wrapper.className="field-row";
  const label=document.createElement("label"); label.textContent=labelText; wrapper.appendChild(label);
  const sel=document.createElement("select");
  const placeholder=document.createElement("option"); placeholder.value=""; placeholder.textContent="Select"; placeholder.selected=true;
  sel.appendChild(placeholder);
  options.forEach(o=>{const opt=document.createElement("option"); opt.value=o; opt.textContent=o; sel.appendChild(opt);});
  sel.onchange=()=>{ if(sel.querySelector('option[value=""]')) sel.removeChild(sel.querySelector('option[value=""]')); answers[key]=sel.value; postAutosave(key,sel.value); };
  wrapper.appendChild(sel); container.appendChild(wrapper);
}

function addRadio(container,key,labelText,options){
  const wrapper=document.createElement("div"); wrapper.className="field-row";
  const label=document.createElement("label"); label.textContent=labelText; wrapper.appendChild(label);
  options.forEach(o=>{
    const row=document.createElement("label");
    const r=document.createElement("input"); r.type="radio"; r.name=key; r.value=o;
    r.onchange=()=>{answers[key]=o; postAutosave(key,o);};
    row.appendChild(r); row.appendChild(document.createTextNode(" "+o));
    wrapper.appendChild(row);
  });
  container.appendChild(wrapper);
}

function addText(container,key,labelText){
  const wrapper=document.createElement("div"); wrapper.className="field-row";
  const label=document.createElement("label"); label.textContent=labelText; wrapper.appendChild(label);
  const inp=document.createElement("input"); inp.type="text";
  inp.onblur=()=>{answers[key]=inp.value; postAutosave(key,inp.value);};
  wrapper.appendChild(inp); container.appendChild(wrapper);
}

function postAutosave(fieldName,fieldValue,extra={}){
  fetch(WEBAPP_URL,{
    method:"POST",
    body:JSON.stringify({sessionId,fieldName,fieldValue,...extra})
  });
}

document.getElementById("submitBtn").onclick
